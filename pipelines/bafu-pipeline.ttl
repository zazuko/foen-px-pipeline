@base <urn:pipeline:bafu-ld> .
@prefix : <https://pipeline.described.at/> .
@prefix code: <https://code.described.at/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

_:common-vars :variable
  [ a :Variable; :name "targetDir"; :value "target" ] ,
  [ a :Variable; :name "mappingsDir"; :value "metadata" ],
  [ a :Variable; :name "sourceDir"; :value "source" ] .
# ------------------------------
#
# Root pipeline
#
# Entire workflow: download, extract and process files
#
# ------------------------------

<#Root> a :Pipeline, :Readable ;
  :steps [
        :stepList ( <#readFile> <#parseJson> <#transformChunk>)
    ] .

<#readFile> a :Step;
  code:implementedBy [
    code:link <node:fs#createReadStream>;
    a code:EcmaScript
  ];
  code:arguments ("source/pxfiles.json"^^:VariableName).
  
<#parseJson> a :Step;
  code:implementedBy [
    code:link <node:barnard59-base#json.parse>;
    a code:EcmaScript
  ].

<#transformChunk> a :Step;
  code:implementedBy [
    code:link <file:../lib/chunk#separate> ;
    a code:EcmaScript
  ].